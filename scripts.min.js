(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{253:function(t,e,n){"use strict";n.r(e);var o=n(29),a=n.n(o),i=n(94),r=n.n(i),s=n(95),c=n.n(s),u=n(96),l=n.n(u),d=n(97),p=n.n(d),m=n(98),f=n.n(m),h=n(99),g=n.n(h),v=n(100),y=n.n(v),b=n(101),w=n.n(b),k=n(102),S=n.n(k),A=n(103),_=n.n(A),I={each:r.a,eachRight:c.a,template:l.a,has:p.a,trim:f.a,toUpper:g.a,noop:y.a,isString:w.a,replace:S.a,first:_.a};function O(t,e,n,o){a.a[t](e,n,function(t){var e=I.isString(n)?t.target.closest(n):n;o(t,e)})}var P=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];O.apply(void 0,["on"].concat(e))},j=(a.a.off,a.a.get,n(0)),M=n.n(j),T=n(1),x=n.n(T),R=n(104),q=new(function(){function t(){M()(this,t),this._els=document.querySelectorAll("[data-scrollbar]")}return x()(t,[{key:"scrollInit",value:function(){I.each(this._els,function(t){t.removeAttribute("data-simplebar"),new R.a(t)})}}]),t}()),z=new(function(){function t(){M()(this,t),this.marsruty=null}return x()(t,[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this.start(),setInterval(function(){t.start()},1e3*e)}},{key:"start",value:function(){}}]),t}()),B=new function t(){M()(this,t)},D=n(48),C=n.n(D),N=new(function(){function t(){M()(this,t),this._templates=document.querySelector("#templates")}return x()(t,[{key:"get",value:function(t){return t?this._templates.querySelector('[type="text/template"][data-name="'.concat(t,'"]')).textContent:this._templates.querySelectorAll('[type="text/template"]')}}]),t}()),V=new(function(){function t(){M()(this,t),this._initEvents()}return x()(t,[{key:"_initEvents",value:function(){P("dblclick",".js-reset",function(){localStorage.clear(),window.open(window.location.href,"_self")}),P("contextmenu",document,function(t){t.preventDefault()})}},{key:"render",value:function(t,e){var n=N.get(e),o=I.template(n);return t._=I,o(t)}}]),t}()),E=new(function(){function t(e){M()(this,t),this.count=e||1,this.private={reloadPageInterval:null}}return x()(t,[{key:"_init",value:function(){var t=6e4*this.count;this.private.reloadPageInterval=setInterval(function(){window.open("./index.php","_self")},t)}},{key:"reset",value:function(){clearInterval(this.private.reloadPageInterval),this._init()}}]),t}()),H=n(30),J=n.n(H),G=n(107);function U(t){var e=new G.a;return I.each(t.data,function(t,n){e.append(n,t)}),e}J.a.defaults.baseURL="",J.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var Y=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=function(t){console.log(t)},n=t.success||e,o=new Set(["POST","PUT"]),a={};a.url=t.action?t.action:window.location.href,a.method=t.method?t.method:"GET",o.has(I.toUpper(a.method))?a.data=U(t.data):a.params=t.data,J()(a).then(function(t){n(t.data)}).catch(function(t){console.log(t)})},Z=new(function(){function t(){M()(this,t)}return x()(t,[{key:"getRoutes",value:function(t){var e=this;Y({action:"../api/inf74.php",success:function(e){t(e)}}),setTimeout(function(){e.getRoutes(t)},1e4)}}]),t}()),F=new(function(){function t(){M()(this,t),this.leaflet=document.querySelector("#leaflet"),this.leafletMAP=null,this.leafletLAYER=null,this.leafletDB={},this.stopName="пл. Революции",this.coords=[55.16041,61.40567],this.suggests=[],this._map=null,this._zoom=17,this._routes=[],this._routesStr=null,this.superlist={temp:[]}}return x()(t,[{key:"init",value:function(){var t=this;ymaps.ready(function(){t.isMap()&&(t.map=new ymaps.Map("map",{center:t.coords,zoom:t._zoom,controls:[]}),t.empty(),P("click",".js-ymaps-route",function(e){var n=e.target.getAttribute("data-id");t._routesStr.setActiveRoute(t._routes[Number(n)]),t.map.geoObjects.add(t._routesStr),t.map.container.fitToViewport(),t.map.setBounds(t.map.geoObjects.getBounds()),t.reset(),t.leaflet&&t.leaflet.classList.add("b-hidden")}),t.leafletInit(),t.transportInit(),t.isSearch()&&t.searchInit(),t.getAllRoutes())})}},{key:"leafletInit",value:function(){this.leaflet&&(this.leafletMAP=L.map("leaflet",{center:this.coords,zoom:this._zoom,scrollWheelZoom:!1,zoomControl:!1,attributionControl:!1,closePopupOnClick:!1}),L.marker([55.16041,61.40567],{icon:L.divIcon({html:'\n        <div style="\n          width: 54px;\n          height: 54px;\n          box-shadow: 0 11px 13px rgba(0, 0, 0, 0.47);\n          border: 5px solid #ffffff;\n          background-color: #084ac4;\n          border-radius: 50%;\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translateX(-50%);\n          z-index: 4;\n        "></div>'})}).addTo(this.leafletMAP).bindPopup("\n      <div style='text-align: center; color: #084ac4; font-size: 30px; font-weight: 700;'>ВЫ ЗДЕСЬ</div>\n      <div style='text-align: center; font-size: 24px;'>ост. Пл. Революции</div>",{closeButton:!1,closeOnClick:!1}).openPopup(),this.leafletLAYER=L.layerGroup().addTo(this.leafletMAP),L.yandex().addTo(this.leafletMAP))}},{key:"getAllRoutes",value:function(){var t=document.body.getAttribute("data-route-id"),e=document.body.getAttribute("data-api-static"),n=localStorage.getItem(e);if(t&&n){var o=JSON.parse(n),a=o.shapes[t];o.stops;if(this.map.geoObjects.add(new ymaps.GeoObject({geometry:{type:"Point",coordinates:this.coords},properties:{iconContent:"<b>ВЫ ЗДЕСЬ</b>"}},{preset:"islands#blackStretchyIcon",draggable:!1,iconColor:"#084ac4"})),Object.keys(a).length){var i=null;i=I.has(a,"".concat(t,"_a-b"))?a["".concat(t,"_a-b")]:I.has(a,"".concat(t,"_b-a"))?a["".concat(t,"_b-a")]:I.first(Object.values(a)),this.map.geoObjects.add(new ymaps.GeoObject({geometry:{type:"LineString",coordinates:i}},{strokeColor:"#ae81ff",strokeWidth:5})),this.map.setBounds(this.map.geoObjects.getBounds())}this.reset()}}},{key:"transportInit",value:function(){var t=this;Z.getRoutes(function(e){var n=Object.keys(e),o=Object.keys(t.leafletDB),a=n.filter(function(t){return!o.includes(t)}),i=o.filter(function(t){return!n.includes(t)});I.each(a,function(n){var o=e[n],a=L.animatedMarker([o.coords],{icon:L.divIcon({html:V.render(o,"marker")}),title:o.name,riseOnHover:!0,interval:3e4}).addTo(t.leafletLAYER);t.leafletDB[n]={route:o,marker:a,coords:[o.coords]}}),I.each(i,function(e){t.leafletMAP.removeLayer(t.leafletDB[e].marker),delete t.leafletDB[e]}),I.each(e,function(e,n){if(![].concat(C()(a),C()(i)).includes(n)){var o=t.leafletDB[n],r=o.marker,s=document.querySelector('.js-marker-azimuth[data-id="'.concat(n,'"]'));s&&e.azimuth&&(s.style.transform="rotate(".concat(e.azimuth,"deg)")),o.coords.push(e.coords),o.coords.length>4&&o.coords.shift(),o.coords.length>3&&(r.setLine(o.coords),r.start())}})})}},{key:"searchInit",value:function(){var t=this;new ymaps.SuggestView("suggest",{provider:{suggest:function(e){var n=ymaps.suggest("Челябинск,"+e);return n.then(function(e){t.suggests=e}),n}}}).events.add("select",function(e){t.drawingPaths(e.get("item").value),t.map.setZoom(t._zoom),t.map.setCenter(t.coords),t.map.container.fitToViewport(),t.reset(),t.leaflet&&t.leaflet.classList.add("b-hidden")}),P("input","#suggest",function(e){t.reset()})}},{key:"reset",value:function(){E.reset()}},{key:"empty",value:function(){if(this.isMap()){this.map.geoObjects.removeAll();var t=document.body.getAttribute("data-api-static");if(localStorage.getItem(t)){var e=JSON.parse(localStorage.getItem(t));this.stopName=e.stop.name,this.coords=e.stop.coords}this.map.setZoom(this._zoom),this.map.setCenter(this.coords),this.map.container.fitToViewport(),this.transportInit()}this.leafletMAP&&this.leafletMAP.setView(this.coords,this._zoom)}},{key:"drawingPaths",value:function(t){var e=this;ymaps.geocode(t).then(function(t){var n=t.geoObjects.get(0).properties.get("boundedBy"),o=[(n[1][0]-n[0][0])/2+n[0][0],(n[1][1]-n[0][1])/2+n[0][1]];e.empty(),e.map.geoObjects.removeAll(),e.map.geoObjects.add(new ymaps.multiRouter.MultiRoute({referencePoints:[e.coords,o],params:{routingMode:"masstransit"}},{boundsAutoApply:!0})),ymaps.route([e.coords,o],{routingMode:"masstransit",mapStateAutoApply:!0,multiRoute:!0}).then(function(t){document.querySelector("#superlist").innerHTML="",e._routesStr=t,e.renderRoutes(t),document.querySelector("#superlist").innerHTML=V.render(e.superlist,"list"),setTimeout(function(){e.map.setBounds(e.map.geoObjects.getBounds()),e.map.container.fitToViewport()},0)},function(t){alert("Возникла ошибка: "+t.message)})})}},{key:"renderRoutes",value:function(t){this._routes=[];for(var e=0;e<t.getRoutes().getLength();e++){var n=t.getRoutes().get(e);this._routes.push(n),this.superlist.temp[e]={duration:n.properties.get("duration").text,distance:n.properties.get("distance").text,list:[]},this.createRoute(n,this.superlist.temp[e])}}},{key:"createRoute",value:function(t,e){for(var n={tramway:"Трамвай",trolleybus:"Троллейбус",bus:"Автобус",minibus:"Маршрутка"},o=0,a=t.getPaths().getLength();o<a;o++)for(var i=t.getPaths().get(o),r=0,s=i.getSegments().getLength();r<s;r++){var c=i.getSegments().get(r).properties;null!=c.get("transports")&&(e.list.push(c.get("text")),console.log("`"),c.get("transports").forEach(function(t){console.log(n[t.type]+": "+t.name)}))}this.map.setBounds(this.map.geoObjects.getBounds())}},{key:"isMap",value:function(){return document.querySelector("#map")}},{key:"isSearch",value:function(){return document.querySelector("#suggest")}},{key:"map",get:function(){return this._map},set:function(t){this._map=t}}]),t}()),W=new function t(){M()(this,t),this.gortrans=z,this.static=B,this.maps=F},X={format:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return new Intl.DateTimeFormat("ru",t).format(e)},toParts:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return new Intl.DateTimeFormat("ru",t).formatToParts(e)}};function K(){var t={date:X.format({year:"numeric",month:"long",day:"numeric",weekday:"short"}),time:X.format({hour:"numeric",minute:"numeric"})};I.each(t,function(t,e){"time"===e&&(t=I.replace(t,":",'<span class="header__pulse">:</span>')),document.querySelector(".js-".concat(e)).innerHTML=t})}var Q,$=function(){var t=null;function e(){var e=document.body.getAttribute("data-api-chelgortrans"),n=[];Y({action:"../api/chelgortrans.php",data:{ID:e},success:function(e){I.each(e.split("\n"),function(t){if(t){var e=t.split("=")[0],o=t.split("=")[1];if("m"===e){var a=(i=o).slice(1,i.length-1);a&&function(t,e){var n=t.split(";")[0],o=t.split(";")[1];e.push({type:{"ТБ":"trol","АВ":"bus"}[n.slice(0,2)],name:n.slice(2,n.length),time:Number(o.slice(0,o.length-1))})}(a,n)}}var i}),n.sort(function(t,e){return t.time-e.time});var o=localStorage.getItem(t);o&&(o=JSON.parse(o),I.eachRight(n,function(t){I.each(o.routes,function(e,n,o){if(e.name===t.name&&e.type===t.type){e.time=t.time;var a=o.splice(n,1);o.unshift(a[0])}})}),function(t,e){var n=document.querySelector("#short");if(!n)return;var o=e>6?6:e;0===o?n.innerHTML=V.render({},"empty"):(n.innerHTML=V.render({routes:t,shortCount:o},"short"),W.maps.map.container.fitToViewport(),W.maps.leafletMAP&&W.maps.leafletMAP.setView(W.maps.coords,W.maps._zoom))}(o.routes,n.length),function(t){var e=document.querySelector("#output-all");e&&(W.maps.empty(),e.innerHTML=V.render(t,"all"),q.scrollInit())}(o))}})}t=document.body.getAttribute("data-api-static"),localStorage.getItem(t)||Y({action:"../api/static.php",data:{ID:t},success:function(n){localStorage.setItem(t,JSON.stringify(n)),e()}}),e(),setInterval(function(){e()},3e4)};Q=function(){K(),setInterval(function(){K()},6e4),q.scrollInit(),P("click",".js-tab",function(t){var e=t.target.getAttribute("data-from"),n=document.querySelectorAll(".js-tab");I.each(n,function(t){void 0!==t&&(t.classList.remove("b-active"),I.each(document.querySelectorAll(".js-tabs [data-to]"),function(t){t.setAttribute("hidden","hidden")}))}),t.target.classList.add("b-active"),document.querySelector('.js-tabs [data-to="'.concat(e,'"]')).removeAttribute("hidden")}),W.maps.init(),$()},"loading"!==document.readyState?Q():P("DOMContentLoaded",document,Q)}},[[253,1]]]);
//# sourceMappingURL=scripts.min.js.map